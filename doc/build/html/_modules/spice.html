

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>spice &mdash; spice 1.7_RC documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> spice
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">spice</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>spice</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for spice</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">=====</span>
<span class="sd">Spice</span>
<span class="sd">=====</span>

<span class="sd">Analog simulation interface package for The System Development Kit </span>

<span class="sd">Provides utilities to import spice-like modules to python environment and</span>
<span class="sd">automatically generate testbenches for the most common simulation cases.</span>

<span class="sd">Initially written by Okko JÃ¤rvinen, 2019</span>

<span class="sd">Release 1.6, Jun 2020 supports Eldo and Spectre</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="o">*</span> 
<span class="kn">from</span> <span class="nn">thesdk</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">genfromtxt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">reduce</span>
<span class="kn">from</span> <span class="nn">spice.testbench</span> <span class="k">import</span> <span class="n">testbench</span> <span class="k">as</span> <span class="n">stb</span>
<span class="kn">from</span> <span class="nn">spice.spice_iofile</span> <span class="k">import</span> <span class="n">spice_iofile</span> <span class="k">as</span> <span class="n">spice_iofile</span>
<span class="kn">from</span> <span class="nn">spice.spice_dcsource</span> <span class="k">import</span> <span class="n">spice_dcsource</span> <span class="k">as</span> <span class="n">spice_dcsource</span>
<span class="kn">from</span> <span class="nn">spice.spice_simcmd</span> <span class="k">import</span> <span class="n">spice_simcmd</span> <span class="k">as</span> <span class="n">spice_simcmd</span>
<span class="kn">from</span> <span class="nn">spice.spice_module</span> <span class="k">import</span> <span class="n">spice_module</span> <span class="k">as</span> <span class="n">spice_module</span>

<div class="viewcode-block" id="spice"><a class="viewcode-back" href="../index.html#spice.spice">[docs]</a><span class="k">class</span> <span class="nc">spice</span><span class="p">(</span><span class="n">thesdk</span><span class="p">,</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adding this class as a superclass enforces the definitions </span>
<span class="sd">    for Spice simulations in the subclasses.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#These need to be converted to abstact properties</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_classfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="vm">__name__</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">si_prefix_mult</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Dictionary mapping SI-prefixes to multipliers &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_si_prefix_mult&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_si_prefix_mult</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_si_prefix_mult</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="mf">1e18</span><span class="p">,</span>
                    <span class="s1">&#39;P&#39;</span><span class="p">:</span><span class="mf">1e15</span><span class="p">,</span>
                    <span class="s1">&#39;T&#39;</span><span class="p">:</span><span class="mf">1e12</span><span class="p">,</span>
                    <span class="s1">&#39;G&#39;</span><span class="p">:</span><span class="mf">1e9</span><span class="p">,</span>
                    <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="mf">1e6</span><span class="p">,</span>
                    <span class="s1">&#39;k&#39;</span><span class="p">:</span><span class="mf">1e3</span><span class="p">,</span>
                    <span class="s1">&#39;m&#39;</span><span class="p">:</span><span class="mf">1e-3</span><span class="p">,</span>
                    <span class="s1">&#39;u&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">,</span>
                    <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="mf">1e-9</span><span class="p">,</span>
                    <span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="mf">1e-12</span><span class="p">,</span>
                    <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="mf">1e-15</span><span class="p">,</span>
                    <span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mf">1e-18</span><span class="p">,</span>
                    <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_si_prefix_mult</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">syntaxdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internally used dictionary for common syntax conversions between</span>
<span class="sd">        Spectre, Eldo, and Ngspice.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">==</span><span class="s1">&#39;eldo&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_syntaxdict</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;cmdfile_ext&quot;</span> <span class="p">:</span> <span class="s1">&#39;.cir&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;resultfile_ext&quot;</span> <span class="p">:</span> <span class="s1">&#39;.wdb&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;commentchar&quot;</span> <span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;commentline&quot;</span> <span class="p">:</span> <span class="s1">&#39;***********************</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;nprocflag&quot;</span> <span class="p">:</span> <span class="s1">&#39;-use_proc &#39;</span><span class="p">,</span> <span class="c1">#space required</span>
                    <span class="s2">&quot;simulatorcmd&quot;</span> <span class="p">:</span> <span class="s1">&#39;eldo -64b&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;dcsource_declaration&quot;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;parameter&quot;</span> <span class="p">:</span> <span class="s1">&#39;.param &#39;</span><span class="p">,</span>
                    <span class="s2">&quot;option&quot;</span> <span class="p">:</span> <span class="s1">&#39;.option &#39;</span><span class="p">,</span>
                    <span class="s2">&quot;include&quot;</span> <span class="p">:</span> <span class="s1">&#39;.include&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;dspfinclude&quot;</span> <span class="p">:</span> <span class="s1">&#39;.include&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;subckt&quot;</span> <span class="p">:</span> <span class="s1">&#39;.subckt&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;lastline&quot;</span> <span class="p">:</span> <span class="s1">&#39;.end&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;eventoutdelim&quot;</span> <span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
                    <span class="s2">&quot;csvskip&quot;</span> <span class="p">:</span> <span class="mi">2</span>
                    <span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">==</span><span class="s1">&#39;spectre&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_syntaxdict</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;cmdfile_ext&quot;</span> <span class="p">:</span> <span class="s1">&#39;.scs&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;resultfile_ext&quot;</span> <span class="p">:</span> <span class="s1">&#39;.raw&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;commentchar&quot;</span> <span class="p">:</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;commentline&quot;</span> <span class="p">:</span> <span class="s1">&#39;///////////////////////</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;nprocflag&quot;</span> <span class="p">:</span> <span class="s1">&#39;+mt=&#39;</span><span class="p">,</span> <span class="c1">#space required??</span>
                    <span class="s2">&quot;simulatorcmd&quot;</span> <span class="p">:</span> <span class="s1">&#39;spectre&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;dcsource_declaration&quot;</span> <span class="p">:</span> <span class="s1">&#39;vsource type=dc dc=&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;parameter&quot;</span> <span class="p">:</span> <span class="s1">&#39;parameters &#39;</span><span class="p">,</span>
                    <span class="s2">&quot;option&quot;</span> <span class="p">:</span> <span class="s1">&#39;options &#39;</span><span class="p">,</span>
                    <span class="s2">&quot;include&quot;</span> <span class="p">:</span> <span class="s1">&#39;include &#39;</span><span class="p">,</span>
                    <span class="s2">&quot;dspfinclude&quot;</span> <span class="p">:</span> <span class="s1">&#39;dspf_include &#39;</span><span class="p">,</span>
                    <span class="s2">&quot;subckt&quot;</span> <span class="p">:</span> <span class="s1">&#39;subckt&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;lastline&quot;</span> <span class="p">:</span> <span class="s1">&#39;///&#39;</span><span class="p">,</span> <span class="c1">#needed?</span>
                    <span class="s2">&quot;eventoutdelim&quot;</span> <span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;csvskip&quot;</span> <span class="p">:</span> <span class="mi">0</span>
                    <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">==</span><span class="s1">&#39;ngspice&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_syntaxdict</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;cmdfile_ext&quot;</span> <span class="p">:</span> <span class="s1">&#39;.ngcir&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;resultfile_ext&quot;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;commentchar&quot;</span> <span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;commentline&quot;</span> <span class="p">:</span> <span class="s1">&#39;***********************</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;nprocflag&quot;</span> <span class="p">:</span> <span class="s1">&#39;set num_threads=&#39;</span><span class="p">,</span> <span class="c1">#Goes to .control section</span>
                    <span class="s2">&quot;simulatorcmd&quot;</span> <span class="p">:</span> <span class="s1">&#39;ngspice -b&#39;</span><span class="p">,</span> 
                    <span class="c1">#&quot;dcsource_declaration&quot; : &#39;&#39;,</span>
                    <span class="s2">&quot;parameter&quot;</span> <span class="p">:</span> <span class="s1">&#39;.param &#39;</span><span class="p">,</span>
                    <span class="s2">&quot;option&quot;</span> <span class="p">:</span> <span class="s1">&#39;.option &#39;</span><span class="p">,</span>
                    <span class="s2">&quot;include&quot;</span> <span class="p">:</span> <span class="s1">&#39;.include&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;dspfinclude&quot;</span> <span class="p">:</span> <span class="s1">&#39;.include&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;subckt&quot;</span> <span class="p">:</span> <span class="s1">&#39;.subckt&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;lastline&quot;</span> <span class="p">:</span> <span class="s1">&#39;.end&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;eventoutdelim&quot;</span> <span class="p">:</span> <span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="c1"># Two spaces</span>
                    <span class="s2">&quot;csvskip&quot;</span> <span class="p">:</span> <span class="mi">1</span>
                    <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syntaxdict</span>
    <span class="nd">@syntaxdict</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">syntaxdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_syntaxdict</span><span class="o">=</span><span class="n">value</span>
    <span class="c1">#Name derived from the file</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">preserve_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="sd">&quot;&quot;&quot;True | False (default)</span>

<span class="sd">        If True, do not delete result files after simulations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_preserve_result&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preserve_result</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preserve_result</span>
    <span class="nd">@preserve_result</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">preserve_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preserve_result</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">preserve_iofiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="sd">&quot;&quot;&quot;True | False (default)</span>

<span class="sd">        If True, do not delete file IO files after simulations. Useful for</span>
<span class="sd">        debugging the file IO&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_preserve_iofiles&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preserve_iofiles</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preserve_iofiles</span>
    <span class="nd">@preserve_iofiles</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">preserve_iofiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;preserve_iofiles is replaced with preserve_result since v1.7&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preserve_iofiles</span><span class="o">=</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Setting preserve_result to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preserve_result</span><span class="o">=</span><span class="n">value</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">preserve_spicefiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="sd">&quot;&quot;&quot;True | False (default)</span>

<span class="sd">        If True, do not delete generated Spice files (testbench, subcircuit,</span>
<span class="sd">        etc.) after simulations.  Useful for debugging.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_preserve_spicefiles&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preserve_spicefiles</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preserve_spicefiles</span>
    <span class="nd">@preserve_spicefiles</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">preserve_spicefiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;preserve_spicefiles is replaced with preserve_result since v1.7&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preserve_spicefiles</span><span class="o">=</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Setting preserve_result to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preserve_result</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">distributed_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Boolean (default False)</span>
<span class="sd">            If True, distributes applicable simulations (currently DC sweep supported)</span>
<span class="sd">            into the LSF cluster. The number of subprocesses launched is</span>
<span class="sd">            set by self.num_processes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_distributed_run&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distributed_run</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_distributed_run</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">distributed_run</span>
    <span class="nd">@distributed_run</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">distributed_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_distributed_run</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; integer</span>
<span class="sd">            Maximum number of spawned child processes for distributed runs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_num_processes&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_processes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_processes</span><span class="o">=</span><span class="mi">10</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span>
    <span class="nd">@num_processes</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">num_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_processes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="sd">&quot;&quot;&quot;String (Default &#39;&#39;)</span>

<span class="sd">        Feature for loading results of previous simulation.  The Spice</span>
<span class="sd">        simulation is not re-executed, but the outputs will be read from</span>
<span class="sd">        existing files.</span>
<span class="sd">        </span>
<span class="sd">        Example inputs::</span>

<span class="sd">            self.load_state = &#39;last&#39; # load latest</span>
<span class="sd">            self.load_state = &#39;latest&#39; # load latest</span>
<span class="sd">            self.load_state = &#39;20201002103638_tmpdbw11nr4&#39; # load results matching this name</span>
<span class="sd">            self.load_state = &#39;zzzz&#39; (non-existent directory) # list available directories to load</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_load_state&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_state</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_state</span>
    <span class="nd">@load_state</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_state</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spicecorner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="sd">&quot;&quot;&quot;Dictionary</span>

<span class="sd">        Feature for specifying the &#39;section&#39; of the model library file and</span>
<span class="sd">        simulation temperature. The path to model libraries should be set in</span>
<span class="sd">        TheSDK.config as either ELDOLIBFILE, SPECTRELIBFILE or NGSPICELIBFILE variable.</span>

<span class="sd">        Example::</span>

<span class="sd">            self.spicecorner = {</span>
<span class="sd">                    &#39;temp&#39;: 27,</span>
<span class="sd">                    &#39;corner&#39;: &#39;top_tt&#39;</span>
<span class="sd">                    }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_spicecorner&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicecorner</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spicecorner</span><span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;temp&#39;</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span>
                    <span class="s1">&#39;corner&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
                    <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicecorner</span>
    <span class="nd">@spicecorner</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">spicecorner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spicecorner</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spiceoptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="sd">&quot;&quot;&quot;Dictionary</span>

<span class="sd">        Feature for specifying options for spice simulation. The key is the</span>
<span class="sd">        name of the option (as in simulator manual specifies), and the value is</span>
<span class="sd">        the value given to said option. Valid key-value pairs can be found from</span>
<span class="sd">        the manual of the simulator (Eldo, Spectre or Ngspice).</span>

<span class="sd">        Example::</span>

<span class="sd">            self.spiceoptions = {</span>
<span class="sd">                       &#39;save&#39;: &#39;lvlpub&#39;,</span>
<span class="sd">                       &#39;nestlvl&#39;: &#39;1&#39;,</span>
<span class="sd">                       &#39;pwr&#39;: &#39;subckts&#39;,</span>
<span class="sd">                       &#39;digits&#39;: &#39;12&#39;</span>
<span class="sd">                   }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_spiceoptions&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spiceoptions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spiceoptions</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spiceoptions</span>
    <span class="nd">@spiceoptions</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">spiceoptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spiceoptions</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spiceparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;Dictionary</span>

<span class="sd">        Feature for specifying simulation parameters for spice simulation. The</span>
<span class="sd">        key is the name of the parameter , and the value is the value given to</span>
<span class="sd">        said parameter.</span>

<span class="sd">        Example::</span>

<span class="sd">            self.spiceparameters = {</span>
<span class="sd">                       &#39;nf_pmos&#39;: 8,</span>
<span class="sd">                       &#39;nf_nmos&#39;: 4,</span>
<span class="sd">                       &#39;ibias&#39;: 100e-6</span>
<span class="sd">                   }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_spiceparameters&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spiceparameters</span> <span class="o">=</span><span class="nb">dict</span><span class="p">([])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spiceparameters</span>
    <span class="nd">@spiceparameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">spiceparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_spiceparameters</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">runname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String </span>
<span class="sd">        </span>
<span class="sd">        Automatically generated name for the simulation. </span>
<span class="sd">        </span>
<span class="sd">        Formatted as timestamp_randomtag, i.e. &#39;20201002103638_tmpdbw11nr4&#39;.</span>
<span class="sd">        Can be overridden by assigning self.runname = &#39;myname&#39;.</span>

<span class="sd">        Example::</span>

<span class="sd">            self.runname = &#39;test&#39;</span>

<span class="sd">        would generate the simulation files in `Simulations/spicesim/test/`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_runname&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runname</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_runname</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> \
                    <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">),</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runname</span>
    <span class="nd">@runname</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">runname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_runname</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">interactive_spice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; True | False (default)</span>
<span class="sd">        </span>
<span class="sd">        Launch simulator in interactive mode. For Eldo, opens also ezwave.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_interactive_spice&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive_spice</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_interactive_spice</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive_spice</span>
    <span class="nd">@interactive_spice</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">interactive_spice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interactive_spice</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nproc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Integer</span>
<span class="sd">        </span>
<span class="sd">        Requested maximum number of threads for multithreaded simulations. For</span>
<span class="sd">        Eldo, maps to command line parameter &#39;-nproc&#39;. For Spectre, maps to</span>
<span class="sd">        command line parameter &#39;+mt&#39;.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_nproc&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nproc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nproc</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nproc</span>
    <span class="nd">@nproc</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">nproc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nproc</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">errpreset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String</span>
<span class="sd">        </span>
<span class="sd">        Global accuracy parameter for Spectre simulations. Options include</span>
<span class="sd">        &#39;liberal&#39;, &#39;moderate&#39; and &#39;conservative&#39;, in order of rising</span>
<span class="sd">        accuracy.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_errpreset&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errpreset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_errpreset</span><span class="o">=</span><span class="s1">&#39;moderate&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errpreset</span>
    <span class="nd">@errpreset</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">errpreset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errpreset</span><span class="o">=</span><span class="n">value</span>

    <span class="c1"># DSPF filenames</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dspf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;List&lt;String&gt;</span>
<span class="sd">        </span>
<span class="sd">        List containing filenames for DSPF-files to be included for post-layout</span>
<span class="sd">        simulations. The names given in this list are matched to dspf-files in</span>
<span class="sd">        &#39;./spice/&#39; -directory. A postfix &#39;.pex.dspf&#39; is automatically appended</span>
<span class="sd">        to the given names (this will probably change later).</span>
<span class="sd">        </span>
<span class="sd">        Example::</span>

<span class="sd">            self.dspf = [&#39;inv_v2&#39;,&#39;switch_v3&#39;]</span>

<span class="sd">        would include files &#39;./spice/inv_v2.pex.dspf&#39; and</span>
<span class="sd">        &#39;./spice/switch_v3.pex.dspf&#39; as dspf-files in the testbench. If the</span>
<span class="sd">        dspf-file contains definition matching the original design name of the</span>
<span class="sd">        top-level netlist, it gets also renamed to match the module name</span>
<span class="sd">        (dspf-file for top-level instance is possible).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_dspf&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dspf</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dspf</span>
    <span class="nd">@dspf</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dspf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dspf</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iofile_eventdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary to store event type output from spectre simulations. This should speed up reading the results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_iofile_eventdict&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iofile_eventdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;out&#39;</span> <span class="ow">or</span> <span class="n">val</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;output&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">iotype</span><span class="o">==</span><span class="s1">&#39;event&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">ionames</span><span class="p">:</span>
                        <span class="c1"># Eldo seems to force output names to uppercase, let&#39;s</span>
                        <span class="c1"># uppercase everything here to avoid key mismatches</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_iofile_eventdict</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iofile_eventdict</span>
    <span class="nd">@iofile_eventdict</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">iofile_eventdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iofile_eventdict</span><span class="o">=</span><span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iofile_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        A thesdk.Bundle containing spice_iofile objects. The iofile objects</span>
<span class="sd">        are automatically added to this Bundle, nothing should be manually</span>
<span class="sd">        added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_iofile_bundle&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iofile_bundle</span><span class="o">=</span><span class="n">Bundle</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iofile_bundle</span>
    <span class="nd">@iofile_bundle</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">iofile_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iofile_bundle</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dcsource_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        A thesdk.Bundle containing spice_dcsource objects. The dcsource objects</span>
<span class="sd">        are automatically added to this Bundle, nothing should be manually</span>
<span class="sd">        added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_dcsource_bundle&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dcsource_bundle</span><span class="o">=</span><span class="n">Bundle</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dcsource_bundle</span>
    <span class="nd">@dcsource_bundle</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dcsource_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dcsource_bundle</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">simcmd_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        A thesdk.Bundle containing spice_simcmd objects. The simcmd objects</span>
<span class="sd">        are automatically added to this Bundle, nothing should be manually</span>
<span class="sd">        added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_simcmd_bundle&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_simcmd_bundle</span><span class="o">=</span><span class="n">Bundle</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simcmd_bundle</span>
    <span class="nd">@simcmd_bundle</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">simcmd_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_simcmd_bundle</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">extracts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        A thesdk.Bundle containing extracted quantities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_extracts&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extracts</span><span class="o">=</span><span class="n">Bundle</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extracts</span>
    <span class="nd">@extracts</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">extracts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extracts</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">has_lsf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returs True if LSF submissions are properly defined. Default False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="ow">not</span> <span class="n">thesdk</span><span class="o">.</span><span class="n">GLOBALS</span><span class="p">[</span><span class="s1">&#39;LSFINTERACTIVE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">thesdk</span><span class="o">.</span><span class="n">GLOBALS</span><span class="p">[</span><span class="s1">&#39;LSFSUBMISSION&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_has_lsf</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_has_lsf</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_lsf</span>

    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">spice_submission</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines spice submission prefix from thesdk.GLOBALS[&#39;LSFSUBMISSION&#39;]</span>
<span class="sd">        and thesdk.GLOBALS[&#39;LSFINTERACTIVE&#39;] for LSF submissions.</span>

<span class="sd">        Usually something like &#39;bsub -K&#39; and &#39;bsub -I&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_spice_submission&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_lsf</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;LSF not configured. Running locally&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_spice_submission</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactive_spice</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">distributed_run</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_spice_submission</span> <span class="o">=</span> <span class="n">thesdk</span><span class="o">.</span><span class="n">GLOBALS</span><span class="p">[</span><span class="s1">&#39;LSFINTERACTIVE&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
                        <span class="k">else</span><span class="p">:</span> <span class="c1"># Spectre LSF doesn&#39;t support interactive queues</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Cannot run in interactive mode if distributed mode is on!&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_spice_submission</span> <span class="o">=</span> <span class="n">thesdk</span><span class="o">.</span><span class="n">GLOBALS</span><span class="p">[</span><span class="s1">&#39;LSFSUBMISSION&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; -o </span><span class="si">%s</span><span class="s1">/bsublog.txt &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_spice_submission</span> <span class="o">=</span> <span class="n">thesdk</span><span class="o">.</span><span class="n">GLOBALS</span><span class="p">[</span><span class="s1">&#39;LSFSUBMISSION&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; -o </span><span class="si">%s</span><span class="s1">/bsublog.txt &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span><span class="p">)</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Error while defining spice submission command. Running locally.&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_spice_submission</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spice_submission</span>
    <span class="nd">@spice_submission</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">spice_submission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spice_submission</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plotlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            OBSOLETE! RE-LOCATED TO SPICE_SIMCMD.PY</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Plotlist has been relocated as a parameter to spice_simcmd!&#39;</span><span class="p">)</span> 
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_plotlist&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plotlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plotlist</span> 
    <span class="nd">@plotlist</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">plotlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Plotlist has been relocated as a parameter to spice_simcmd!&#39;</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotlist</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spicemisc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;List&lt;String&gt;</span>

<span class="sd">        List of manual commands to be pasted to the testbench. The strings are</span>
<span class="sd">        pasted to their own lines (no linebreaks needed), and the syntax is</span>
<span class="sd">        unchanged.</span>

<span class="sd">        Example: setting initial voltages from testbench (Eldo)::</span>

<span class="sd">            self.spicemisc = []</span>
<span class="sd">            for i in range(nodes):</span>
<span class="sd">                self.spicemisc.append(&#39;.ic NODE&lt;%d&gt; 0&#39; % i)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_spicemisc&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spicemisc</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicemisc</span>
    <span class="nd">@spicemisc</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">spicemisc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_spicemisc</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String</span>

<span class="sd">        Name of the module.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_name&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_classfile</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">entitypath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String</span>

<span class="sd">        Path to the entity root.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_entitypath&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entitypath</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_classfile</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entitypath</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spicesrcpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String</span>

<span class="sd">        Path to the spice source of the entity (&#39;./spice&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spicesrcpath</span>  <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">entitypath</span> <span class="o">+</span> <span class="s1">&#39;/spice&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spicesrcpath</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spicesrcpath</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Creating </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicesrcpath</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Failed to create </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicesrcpath</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicesrcpath</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spicesrc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String</span>

<span class="sd">        Path to the source netlist (i.e. &#39;spice/entityname.scs&#39;).</span>
<span class="sd">        This shouldn&#39;t be set manually.</span>

<span class="sd">        .. note::</span>

<span class="sd">            Provided netlist name has to match entity name (entityname.scs or entityname.cir).</span>

<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            Netlist has to contain the top-level design as a subcircuit definition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_spicesrc&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spicesrc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesrcpath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">syntaxdict</span><span class="p">[</span><span class="s2">&quot;cmdfile_ext&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spicesrc</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;No source circuit found in </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicesrc</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicesrc</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spicetbsrc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String</span>

<span class="sd">        Path to the spice testbench (&#39;./Simulations/spicesim/&lt;runname&gt;/tb_entityname.&lt;suffix&gt;&#39;).</span>
<span class="sd">        This shouldn&#39;t be set manually.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_spicetbsrc&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spicetbsrc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span> <span class="o">+</span> <span class="s1">&#39;/tb_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">syntaxdict</span><span class="p">[</span><span class="s2">&quot;cmdfile_ext&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicetbsrc</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">eldochisrc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String</span>

<span class="sd">        Path to the Eldo chi-file. (&#39;./Simulations/spicesim/&lt;runname&gt;/tb_entityname.chi&#39;).</span>
<span class="sd">        Only applies to Eldo simulations.</span>
<span class="sd">        This shouldn&#39;t be set manually.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_eldochisrc&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eldochisrc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span> <span class="o">+</span> <span class="s1">&#39;/tb_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.chi&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eldochisrc</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spicesubcktsrc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String</span>

<span class="sd">        Path to the parsed subcircuit file. (&#39;./Simulations/spicesim/&lt;runname&gt;/subckt_entityname.&lt;suffix&gt;&#39;).</span>
<span class="sd">        This shouldn&#39;t be set manually.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_spicesubcktsrc&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spicesubcktsrc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span> <span class="o">+</span> <span class="s1">&#39;/subckt_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">syntaxdict</span><span class="p">[</span><span class="s2">&quot;cmdfile_ext&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicesubcktsrc</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spicesimpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String</span>

<span class="sd">        Simulation path. (./Simulations/spicesim/&lt;runname&gt;)</span>
<span class="sd">        This shouldn&#39;t be set manually.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_spicesimpath&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spicesimpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entitypath</span><span class="o">+</span><span class="s1">&#39;/Simulations/spicesim/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">runname</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spicesimpath</span><span class="p">)):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spicesimpath</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Creating </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicesimpath</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Failed to create </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicesimpath</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicesimpath</span>
    <span class="nd">@spicesimpath</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">spicesimpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">preserve_result</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Cleaning ./</span><span class="si">%s</span><span class="s1">/ (set preserve_result=True to prevent cleaning).&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spicesimpath</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;../&#39;</span><span class="p">))</span>
            <span class="n">keepdb</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span><span class="p">):</span>
                <span class="n">targetpath</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span><span class="p">,</span><span class="n">target</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">targetpath</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">spicedbpath</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactive_spice</span><span class="p">:</span>
                        <span class="n">keepdb</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Preserving ./</span><span class="si">%s</span><span class="s1"> due to interactive_spice&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">targetpath</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;../&#39;</span><span class="p">))</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">targetpath</span><span class="p">):</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">targetpath</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">targetpath</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Removing ./</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">targetpath</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;../&#39;</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Could not remove ./</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">targetpath</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;../&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">keepdb</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Eldo needs some time to disconnect from the jwdb server</span>
                    <span class="c1"># Another dirty hack to check that the process is dead before cleaning</span>
                    <span class="c1"># TODO: figure out if this can be prevented</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;eldo&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Waiting for Eldo to exit...&#39;</span><span class="p">)</span>
                        <span class="n">waittime</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;pgrep </span><span class="se">\&quot;</span><span class="s1">easynch_64.exe</span><span class="se">\&quot;</span><span class="s1"> &gt;/dev/null&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">waittime</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">waittime</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
                                <span class="k">break</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Removing ./</span><span class="si">%s</span><span class="s1">/&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;../&#39;</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Could not remove ./</span><span class="si">%s</span><span class="s1">/&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;../&#39;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spicecmd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String</span>

<span class="sd">        Simulation command string to be executed on the command line.</span>
<span class="sd">        Automatically generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_spicecmd&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nproc</span><span class="p">:</span>
                <span class="n">nprocflag</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">syntaxdict</span><span class="p">[</span><span class="s2">&quot;nprocflag&quot;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">nproc</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Enabling multithreading </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="n">nprocflag</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nprocflag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">postlayout</span><span class="p">:</span>
                <span class="n">plflag</span> <span class="o">=</span> <span class="s1">&#39;+postlayout=upa&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Enabling post-layout optimization </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="n">plflag</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plflag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">==</span><span class="s1">&#39;eldo&#39;</span><span class="p">:</span>
                <span class="c1"># Shouldn&#39;t this use self.syntaxdict[&quot;simulatorcmd&quot;] ?</span>
                <span class="n">spicesimcmd</span> <span class="o">=</span> <span class="s2">&quot;eldo -64b </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nprocflag</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">==</span><span class="s1">&#39;spectre&#39;</span><span class="p">:</span>
                <span class="n">spicesimcmd</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;spectre -64 +lqtimeout=0 ++aps=</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> -outdir </span><span class="si">%s</span><span class="s2"> &quot;</span> 
                        <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errpreset</span><span class="p">,</span><span class="n">plflag</span><span class="p">,</span><span class="n">nprocflag</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">==</span><span class="s1">&#39;ngspice&#39;</span><span class="p">:</span>
                <span class="n">spicesimcmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">syntaxdict</span><span class="p">[</span><span class="s2">&quot;simulatorcmd&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spicecmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spice_submission</span><span class="o">+</span><span class="n">spicesimcmd</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">spicetbsrc</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicecmd</span>
    <span class="nd">@spicecmd</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">spicecmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spicecmd</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spicedbpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String</span>

<span class="sd">        Path to output waveform database. (./Simulations/spicesim/&lt;runname&gt;/tb_&lt;entityname&gt;.&lt;resultfile_ext&gt;)</span>
<span class="sd">        For now only for spectre.</span>
<span class="sd">        This shouldn&#39;t be set manually.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_spicedbpath&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spicedbpath</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span><span class="o">+</span><span class="s1">&#39;/tb_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">syntaxdict</span><span class="p">[</span><span class="s2">&quot;resultfile_ext&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicedbpath</span>
    <span class="nd">@spicedbpath</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">spicedbpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spicedbpath</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plotprogram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the program to be used for visualizing waveform databases.</span>
<span class="sd">        Options are ezwave (default) or viva.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_plotprogram&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plotprogram</span><span class="o">=</span><span class="s1">&#39;ezwave&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plotprogram</span>
    <span class="nd">@plotprogram</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">plotprogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotprogram</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plotprogcmd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the command to be run for interactive simulations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_plotprogcmd&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotprogram</span> <span class="o">==</span> <span class="s1">&#39;ezwave&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plotprogcmd</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> -MAXWND -LOGfile </span><span class="si">%s</span><span class="s1">/ezwave.log </span><span class="si">%s</span><span class="s1"> &amp;&#39;</span> <span class="o">%</span> \
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotprogram</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">spicedbpath</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotprogram</span> <span class="o">==</span> <span class="s1">&#39;viva&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plotprogcmd</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> -datadir </span><span class="si">%s</span><span class="s1"> -nocdsinit &amp;&#39;</span> <span class="o">%</span> \
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotprogram</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">spicedbpath</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plotprogcmd</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Unsupported plot program </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotprogram</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plotprogcmd</span>
    <span class="nd">@plotprogcmd</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">plotprogcmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotprogcmd</span><span class="o">=</span><span class="n">value</span>

<div class="viewcode-block" id="spice.connect_spice_inputs"><a class="viewcode-back" href="../index.html#spice.spice.connect_spice_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">connect_spice_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Automatically called function to connect iofiles (inputs) to top</span>
<span class="sd">        entity IOS Bundle items.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ioname</span><span class="p">,</span><span class="n">io</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">ioname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="p">:</span>
                <span class="n">val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="n">ioname</span><span class="p">]</span>
                <span class="c1"># File type inputs are driven by the file.Data, not the input field</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">Data</span><span class="p">,</span><span class="n">spice_iofile</span><span class="p">)</span> \
                        <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">dir</span> <span class="o">==</span> <span class="s1">&#39;in&#39;</span><span class="p">:</span>
                    <span class="c1"># Data must be properly shaped</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="n">ioname</span><span class="p">]</span><span class="o">.</span><span class="n">Data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="n">ioname</span><span class="p">]</span><span class="o">.</span><span class="n">Data</span></div>

<div class="viewcode-block" id="spice.connect_spice_outputs"><a class="viewcode-back" href="../index.html#spice.spice.connect_spice_outputs">[docs]</a>    <span class="k">def</span> <span class="nf">connect_spice_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Automatically called function to connect iofiles (outputs) to top</span>
<span class="sd">        entity IOS Bundle items.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">dir</span> <span class="o">==</span> <span class="s1">&#39;out&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IOS</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">Data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">Data</span></div>

<div class="viewcode-block" id="spice.write_spice_inputs"><a class="viewcode-back" href="../index.html#spice.spice.write_spice_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">write_spice_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Automatically called function to call write() functions of each</span>
<span class="sd">        iofile with direction &#39;input&#39;.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;in&#39;</span> <span class="ow">or</span> <span class="n">val</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;input&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">()</span></div>

<div class="viewcode-block" id="spice.read_spice_outputs"><a class="viewcode-back" href="../index.html#spice.spice.read_spice_outputs">[docs]</a>    <span class="k">def</span> <span class="nf">read_spice_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Automatically called function to call read() functions of each</span>
<span class="sd">        iofile with direction &#39;output&#39;.&quot;&quot;&quot;</span>
        <span class="n">first</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;out&#39;</span> <span class="ow">or</span> <span class="n">val</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;output&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">iotype</span><span class="o">==</span><span class="s1">&#39;event&#39;</span><span class="p">:</span> <span class="c1"># Event type outs are in same file, read only once to speed up things</span>
                    <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                        <span class="n">first</span><span class="o">=</span><span class="kc">False</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">ionames</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">Data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iofile_eventdict</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">ionames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Invalid ioname </span><span class="si">%s</span><span class="s1"> for iofile </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">ionames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c1"># Iofile is a bus?</span>
                        <span class="n">data</span><span class="o">=</span><span class="p">[]</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">ionames</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iofile_eventdict</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">try</span><span class="p">:</span>
                                        <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iofile_eventdict</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()]]</span>
                                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Invalid dimensions for concatenating arrays for IO </span><span class="si">%s</span><span class="s1">!&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Invalid ioname </span><span class="si">%s</span><span class="s1"> for iofile </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">Data</span><span class="o">=</span><span class="n">data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="spice.execute_spice_sim"><a class="viewcode-back" href="../index.html#spice.spice.execute_spice_sim">[docs]</a>    <span class="k">def</span> <span class="nf">execute_spice_sim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Automatically called function to execute spice simulation.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Running external command </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicecmd</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicecmd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Simulator (</span><span class="si">%s</span><span class="s2">) returned non-zero exit code.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">))</span></div>

<div class="viewcode-block" id="spice.run_plotprogram"><a class="viewcode-back" href="../index.html#spice.spice.run_plotprogram">[docs]</a>    <span class="k">def</span> <span class="nf">run_plotprogram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Starting a parallel process for waveform viewer program.</span>

<span class="sd">        The plotting program command can be set with &#39;plotprogram&#39;.</span>
<span class="sd">        Tested for spectre and eldo.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ngspice&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Interactive plotting not implemented for ngspice.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># This waiting method assumes spectre output.</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">tries</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicedbpath</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;spectre&#39;</span><span class="p">:</span>
                    <span class="c1"># More than just the logfile exists</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicedbpath</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># Database file has something written to it</span>
                        <span class="n">filesize</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicedbpath</span><span class="p">):</span>
                            <span class="n">filesize</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicedbpath</span><span class="p">,</span><span class="n">f</span><span class="p">))</span><span class="o">.</span><span class="n">st_size</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">filesize</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">cmd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotprogcmd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Running external command: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cmd</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> returned with exit status </span><span class="si">%d</span><span class="s1">!&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotprogram</span><span class="p">,</span> <span class="n">ret</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Something went wrong while launcing </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotprogram</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span></div>

<div class="viewcode-block" id="spice.extract_powers"><a class="viewcode-back" href="../index.html#spice.spice.extract_powers">[docs]</a>    <span class="k">def</span> <span class="nf">extract_powers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Automatically called function to extract transient power and current</span>
<span class="sd">        consumptions. The consumptions are extracted for spice_dcsource objects</span>
<span class="sd">        with the attribute extract=True.</span>
<span class="sd">        </span>
<span class="sd">        The extracted consumptions are accessible on the top-level after simulation as::</span>
<span class="sd">            </span>
<span class="sd">            self.extracts.Members[&#39;powers&#39;] # Dictionary with averaged power consumptions of each supply + total</span>
<span class="sd">            self.extracts.Members[&#39;currents&#39;] # Dictionary with averaged current consumptions of each supply + total</span>
<span class="sd">            self.extracts.Members[&#39;curr_tran&#39;] # Dictionary with transient current consumptions of each supply</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;powers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;currents&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;curr_tran&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">dcsources</span><span class="o">.</span><span class="n">Members</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Read transient power consumption of the extracted source</span>
                <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">extract</span> <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">sourcetype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;v&#39;</span><span class="p">:</span>
                    <span class="n">sourcename</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">sourcetype</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span><span class="n">val</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">sourcename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iofile_eventdict</span><span class="p">:</span>
                        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iofile_eventdict</span><span class="p">[</span><span class="n">sourcename</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">ext_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">val</span><span class="o">.</span><span class="n">ext_start</span><span class="p">)[</span><span class="mi">0</span><span class="p">],:]</span>
                        <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">ext_stop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">val</span><span class="o">.</span><span class="n">ext_stop</span><span class="p">)[</span><span class="mi">0</span><span class="p">],:]</span>
                        <span class="c1"># The time points are non-uniform -&gt; use deltas as weights</span>
                        <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">totaltime</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">meancurr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="n">totaltime</span>
                        <span class="n">meanpwr</span> <span class="o">=</span> <span class="n">meancurr</span><span class="o">*</span><span class="n">val</span><span class="o">.</span><span class="n">value</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;currents&#39;</span><span class="p">][</span><span class="n">val</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">meancurr</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;powers&#39;</span><span class="p">][</span><span class="n">val</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">meanpwr</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;curr_tran&#39;</span><span class="p">][</span><span class="n">val</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;powers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Extracted power consumption from transient:&#39;</span><span class="p">)</span>
                <span class="c1"># This is newer Python syntax</span>
                <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;powers&#39;</span><span class="p">],</span><span class="s1">&#39;total&#39;</span><span class="p">],</span><span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;currents&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1"> current = </span><span class="si">%.06f</span><span class="s1"> mA&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">maxlen</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span><span class="mf">1e3</span><span class="o">*</span><span class="n">val</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;currents&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Total</span><span class="si">%s</span><span class="s1"> current = </span><span class="si">%.06f</span><span class="s1"> mA&#39;</span><span class="o">%</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">maxlen</span><span class="o">-</span><span class="mi">5</span><span class="p">),</span><span class="mf">1e3</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;currents&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;powers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1"> power   = </span><span class="si">%.06f</span><span class="s1"> mW&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">maxlen</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span><span class="mf">1e3</span><span class="o">*</span><span class="n">val</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;powers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Total</span><span class="si">%s</span><span class="s1"> power   = </span><span class="si">%.06f</span><span class="s1"> mW&#39;</span><span class="o">%</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">maxlen</span><span class="o">-</span><span class="mi">5</span><span class="p">),</span><span class="mf">1e3</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;powers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Something went wrong while extracting power consumptions.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="spice.get_buswidth"><a class="viewcode-back" href="../index.html#spice.spice.get_buswidth">[docs]</a>    <span class="k">def</span> <span class="nf">get_buswidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">signame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extract buswidth from signal name.</span>
<span class="sd">        </span>
<span class="sd">        Little-endian example::</span>
<span class="sd">                </span>
<span class="sd">            start,stop,width,range = get_buswidth(&#39;BUS&lt;10:0&gt;&#39;)</span>
<span class="sd">            # start = 10</span>
<span class="sd">            # stop = 0</span>
<span class="sd">            # width = 11</span>
<span class="sd">            # range = range(10,-1,-1)</span>

<span class="sd">        Big-endian example::</span>
<span class="sd">                </span>
<span class="sd">            start,stop,width,range = get_buswidth(&#39;BUS&lt;0:8&gt;&#39;)</span>
<span class="sd">            # start = 0</span>
<span class="sd">            # stop = 8</span>
<span class="sd">            # width = 9</span>
<span class="sd">            # range = range(0,9)</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">signame</span> <span class="o">=</span> <span class="n">signame</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;&#39;</span> <span class="ow">in</span> <span class="n">signame</span><span class="p">:</span>
            <span class="n">signame</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">signame</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">busstart</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">busstop</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">signame</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">busstart</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">signame</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">busstop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">signame</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">busstart</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">signame</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">busstop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">signame</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">busstart</span> <span class="o">&gt;</span> <span class="n">busstop</span><span class="p">:</span>
            <span class="n">buswidth</span> <span class="o">=</span> <span class="n">busstart</span><span class="o">-</span><span class="n">busstop</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">busrange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">busstart</span><span class="p">,</span><span class="n">busstop</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">buswidth</span> <span class="o">=</span> <span class="n">busstop</span><span class="o">-</span><span class="n">busstart</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">busrange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">busstart</span><span class="p">,</span><span class="n">busstop</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">busstart</span><span class="p">,</span><span class="n">busstop</span><span class="p">,</span><span class="n">buswidth</span><span class="p">,</span><span class="n">busrange</span></div>
    
<div class="viewcode-block" id="spice.si_string_to_float"><a class="viewcode-back" href="../index.html#spice.spice.si_string_to_float">[docs]</a>    <span class="k">def</span> <span class="nf">si_string_to_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strval</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Convert SI-formatted string to float</span>
<span class="sd">            </span>
<span class="sd">            E.g. self.si_string_to_float(&#39;3 mV&#39;) returns 3e-3.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">strval</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># No prefix</span>
                <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">mult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">si_prefix_mult</span><span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="c1"># Could not convert, just return the text value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Invalid SI-prefix </span><span class="si">%s</span><span class="s1">, failed to convert.&#39;</span> <span class="o">%</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">return</span> <span class="n">strval</span>
            <span class="k">return</span> <span class="n">val</span><span class="o">*</span><span class="n">mult</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">strval</span> <span class="c1"># Was a text value</span></div>

<div class="viewcode-block" id="spice.read_oppts"><a class="viewcode-back" href="../index.html#spice.spice.read_oppts">[docs]</a>    <span class="k">def</span> <span class="nf">read_oppts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Internally called function to read the DC operating points of the circuit</span>
<span class="sd">            TODO: Implement for Eldo as well.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">sorter</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Function for sorting the files in correct order</span>
<span class="sd">            Files that are output from simulation are of form</span>

<span class="sd">            dcSweep-&lt;integer&gt;_oppoint.dc</span>

<span class="sd">            Strategy: extract integer from filename and sort based on the integer.</span>

<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">key</span><span class="o">=</span><span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">==</span><span class="s1">&#39;spectre&#39;</span> <span class="ow">and</span> <span class="s1">&#39;dc&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">simcmd_bundle</span><span class="o">.</span><span class="n">Members</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;oppts&#39;</span> <span class="p">:</span> <span class="p">{}})</span>
                <span class="c1"># Get dc simulation file name</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">simcmd_bundle</span><span class="o">.</span><span class="n">Members</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dc&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">sweep</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                            <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">Sweep*.dc&#39;</span> <span class="o">%</span> <span class="n">val</span><span class="o">.</span><span class="n">sweep</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;oppoint*.dc&#39;</span>
                            <span class="k">break</span>
                <span class="c1"># For distributed runs</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">distributed_run</span><span class="p">:</span>
                    <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span><span class="p">,</span><span class="s1">&#39;tb_</span><span class="si">%s</span><span class="s1">.raw&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;[0-9]*&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
                    <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">key</span><span class="o">=</span><span class="n">sorter</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span><span class="p">,</span><span class="s1">&#39;tb_</span><span class="si">%s</span><span class="s1">.raw&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
                    <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">valbegin</span> <span class="o">=</span> <span class="s1">&#39;VALUE</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">eof</span> <span class="o">=</span> <span class="s1">&#39;END</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">parsevals</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="n">valbegin</span><span class="p">:</span> <span class="c1"># Scan file until unit descriptions end and values start</span>
                                <span class="n">parsevals</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">elif</span> <span class="n">line</span> <span class="o">!=</span> <span class="n">eof</span> <span class="ow">and</span> <span class="n">parsevals</span><span class="p">:</span> <span class="c1"># Scan values from output until EOF</span>
                                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                                <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># This line contains op point parameter (e.g. vgs)</span>
                                        <span class="n">dev</span><span class="p">,</span> <span class="n">param</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                                    <span class="k">elif</span> <span class="s1">&#39;:&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="c1"># This is a node voltage</span>
                                        <span class="n">dev</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="n">param</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                    <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                                    <span class="k">if</span> <span class="n">dev</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;oppts&#39;</span><span class="p">]:</span> <span class="c1"># Found new device</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;oppts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">dev</span> <span class="p">:</span> <span class="p">{}})</span> 
                                    <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;oppts&#39;</span><span class="p">][</span><span class="n">dev</span><span class="p">]:</span> <span class="c1"># Found new parameter for device</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;oppts&#39;</span><span class="p">][</span><span class="n">dev</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">param</span> <span class="p">:</span> <span class="p">[</span><span class="n">val</span><span class="p">]})</span>
                                    <span class="k">else</span><span class="p">:</span> <span class="c1"># Parameter already existed, just append value. This can occur in e.g. sweeps</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="p">[</span><span class="s1">&#39;oppts&#39;</span><span class="p">][</span><span class="n">dev</span><span class="p">][</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">line</span> <span class="o">==</span> <span class="n">eof</span><span class="p">:</span>
                                <span class="n">parsevals</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;eldo&#39;</span> <span class="ow">and</span> <span class="s1">&#39;dc&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">simcmd_bundle</span><span class="o">.</span><span class="n">Members</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;DC optpoint extraction not supported for Eldo.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;dc&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">simcmd_bundle</span><span class="o">.</span><span class="n">Members</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="c1"># Unsupported model</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unrecognized model </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># DC analysis not in simcmds, oppts is empty</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extracts</span><span class="o">.</span><span class="n">Members</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;oppts&#39;</span> <span class="p">:</span> <span class="p">{}})</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Something went wrong while extracting DC operating points.&#39;</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="spice.run_spice"><a class="viewcode-back" href="../index.html#spice.spice.run_spice">[docs]</a>    <span class="k">def</span> <span class="nf">run_spice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Externally called function to execute spice simulation.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_state</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> 
            <span class="c1"># Normal execution of full simulation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tb</span> <span class="o">=</span> <span class="n">stb</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">iofiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">dcsources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcsource_bundle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">simcmds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simcmd_bundle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect_spice_inputs</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">generate_contents</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">export_subckt</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_spice_inputs</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactive_spice</span><span class="p">:</span>
                <span class="n">plotthread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_plotprogram</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;plotting&#39;</span><span class="p">)</span>
                <span class="n">plotthread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execute_spice_sim</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_spice_outputs</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect_spice_outputs</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extract_powers</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_oppts</span><span class="p">()</span>
            <span class="c1"># Clean simulation results</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">spicesimpath</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Loading previous simulation results and not simulating again</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">runname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_state</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runname</span> <span class="o">==</span> <span class="s1">&#39;latest&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">runname</span> <span class="o">==</span> <span class="s1">&#39;last&#39;</span><span class="p">:</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entitypath</span><span class="o">+</span><span class="s1">&#39;/Simulations/spicesim/*&#39;</span><span class="p">)</span>
                    <span class="n">latest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">runname</span> <span class="o">=</span> <span class="n">latest</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">simpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entitypath</span><span class="o">+</span><span class="s1">&#39;/Simulations/spicesim/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">runname</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">simpath</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Existing results not found in </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="n">simpath</span><span class="p">)</span>
                    <span class="n">existing</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entitypath</span><span class="o">+</span><span class="s1">&#39;/Simulations/spicesim/&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Found results:&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">existing</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">f</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Loading results from </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="n">simpath</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tb</span> <span class="o">=</span> <span class="n">stb</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">iofiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iofile_bundle</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">dcsources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcsource_bundle</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">simcmds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simcmd_bundle</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connect_spice_inputs</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_spice_outputs</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connect_spice_outputs</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">extract_powers</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_oppts</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Failed while loading results from </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spicesimpath</span><span class="p">)</span></div></div>

</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019 TheSyDeKick Community.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>